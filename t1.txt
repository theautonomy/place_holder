package com.example.springbootchucknorrisjokes.service;

import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

@Service
public class ChuckNorrisJokeService {
  
    private static final String CHUCK_NORRIS_JOKE_API_URL = "https://api.chucknorris.io/jokes/random";
    
    public String[] getRandomChuckNorrisJoke() {
        RestTemplate restTemplate = new RestTemplate();
        String response = restTemplate.getForObject(CHUCK_NORRIS_JOKE_API_URL, String.class);

        // Extract the joke and icon URL using simple string manipulation or JSON parsing
        String joke = response.substring(response.indexOf("\"value\":\"") + 9, response.indexOf("\",\"url\""));
        String iconUrl = response.substring(response.indexOf("\"icon_url\":\"") + 12, response.indexOf("\",\"value\""));

        return new String[] { joke, iconUrl };
    }
}

package com.example.springbootchucknorrisjokes.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

import com.example.springbootchucknorrisjokes.service.ChuckNorrisJokeService;

@Controller
public class ChuckNorrisJokeController {

    @Autowired
    private ChuckNorrisJokeService chuckNorrisJokeService;

    @GetMapping("/")
    public String index() {
        return "index";
    }

    @GetMapping("/joke")
    public String getJokeFragment(Model model) {
        String[] jokeData = chuckNorrisJokeService.getRandomChuckNorrisJoke();
        model.addAttribute("joke", jokeData[0]);
        model.addAttribute("icon", jokeData[1]);
        return "fragments/joke :: jokeFragment";
    }
}


<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:htmx="http://htmx.org">
<head>
    <title>Chuck Norris Jokes</title>
    <link href="/css/tailwind.build.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.3.3"></script>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">
    <div class="container mx-auto my-8 p-8 bg-white shadow-lg rounded-lg text-center">
        <h1 class="text-3xl font-bold mb-4">Chuck Norris Joke Generator</h1>
        <button class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-700"
                hx-get="/joke" hx-target="#jokeContainer" hx-trigger="click">
            Get a New Joke
        </button>
        <div id="jokeContainer" class="mt-4">
            <!-- Joke will be loaded here -->
        </div>
    </div>
</body>
</html>


<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:htmx="http://htmx.org">
<head>
    <title>Chuck Norris Jokes</title>
    <link href="/css/tailwind.build.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.3.3"></script>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">
    <div class="container mx-auto my-8 p-8 bg-white shadow-lg rounded-lg text-center">
        <h1 class="text-3xl font-bold mb-4">Chuck Norris Joke Generator</h1>
        <button class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-700"
                hx-get="/joke" hx-target="#jokeContainer" hx-trigger="click">
            Get a New Joke
        </button>
        <div id="jokeContainer" class="mt-4">
            <!-- Joke will be loaded here -->
        </div>
    </div>
</body>
</html>
